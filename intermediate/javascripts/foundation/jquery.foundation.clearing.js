(function(f,k){var g={templates:{viewing:'<a href="#" class="clearing-close">&times;</a><div class="visible-img" style="display: none"><img src="#"><p class="clearing-caption"></p><a href="#" class="clearing-main-left"></a><a href="#" class="clearing-main-right"></a></div>'},initialized:!1,locked:!1},i={},e={init:function(){return this.find("ul[data-clearing]").each(function(){f(document);var a=f(this),b=b||{},c=c||{};if(!a.data("fndtn.clearing.settings"))b.$parent=a.parent(),a.data("fndtn.clearing.settings",
f.extend({},g,b)),e.extend(e,c),e.assemble(a.find("li")),g.initialized||e.events()})},events:function(){var a=f(document);a.on("click.fndtn.clearing","ul[data-clearing] li",function(b,a,d){var a=a||f(this),d=d||a,g=a.parent().data("fndtn.clearing.settings");b.preventDefault();g||a.parent().foundationClearing();e.open(f(b.target),a,d);e.update_paddles(d)});f(k).on("resize.fndtn.clearing",function(){var a=f(".clearing-blackout .visible-img").find("img");a.length>0&&e.center(a)});a.on("click.fndtn.clearing",
".clearing-main-right",function(a){var c=f(".clearing-blackout").find("ul[data-clearing]");a.preventDefault();e.go(c,"next")});a.on("click.fndtn.clearing",".clearing-main-left",function(a){var c=f(".clearing-blackout").find("ul[data-clearing]");a.preventDefault();e.go(c,"prev")});a.on("click.fndtn.clearing","a.clearing-close, div.clearing-blackout, div.visible-img",function(a){var c=function(a){return/blackout/.test(a.selector)?a:a.closest(".clearing-blackout")}(f(this)),d;if(this===a.target&&c)d=
c.find("div:first"),a=d.find(".visible-img"),g.prev_index=0,c.find("ul[data-clearing]").attr("style",""),c.removeClass("clearing-blackout"),d.removeClass("clearing-container"),a.hide();return!1});a.on("keydown.fndtn.clearing",function(a){var c=f(".clearing-blackout").find("ul[data-clearing]");a.which===39&&e.go(c,"next");a.which===37&&e.go(c,"prev");a.which===27&&f("a.clearing-close").trigger("click")});a.on("movestart",function(a){(a.distX>a.distY&&a.distX<-a.distY||a.distX<a.distY&&a.distX>-a.distY)&&
a.preventDefault()});a.bind("swipeleft","ul[data-clearing] li",function(){var a=f(".clearing-blackout").find("ul[data-clearing]");e.go(a,"next")});a.bind("swiperight","ul[data-clearing] li",function(){var a=f(".clearing-blackout").find("ul[data-clearing]");e.go(a,"prev")});g.initialized=!0},assemble:function(a){var b=a.parent(),a=b.data("fndtn.clearing.settings"),b='<div class="carousel">'+this.outerHTML(b.detach()[0])+"</div>";return a.$parent.append('<div class="clearing-assembled"><div>'+a.templates.viewing+
b+"</div></div>")},open:function(a,b,c){var d=c.closest(".clearing-assembled"),f=d.find("div:first"),g=f.find(".visible-img"),h=g.find("img").not(a);e.locked()||(h.attr("src",this.load(a)),h.is_good(function(){d.addClass("clearing-blackout");f.addClass("clearing-container");e.caption(g.find(".clearing-caption"),a);g.show();e.fix_height(c);e.center(h);e.shift(b,c,function(){c.siblings().removeClass("visible");c.addClass("visible")})}))},fix_height:function(a){a=a.siblings();a.each(function(){var a=
f(this),c=a.find("img");a.height()>c.outerHeight()&&a.addClass("fix-height")});a.closest("ul").width(a.length*100+"%")},update_paddles:function(a){var b=a.closest(".carousel").siblings(".visible-img");a.next().length>0?b.find(".clearing-main-right").removeClass("disabled"):b.find(".clearing-main-right").addClass("disabled");a.prev().length>0?b.find(".clearing-main-left").removeClass("disabled"):b.find(".clearing-main-left").addClass("disabled")},load:function(a){var b=a.parent().attr("href");this.preload(a);
return b?b:a.attr("src")},preload:function(a){var b=a.closest("li").next(),a=a.closest("li").prev(),c,d;if(b.length>0)d=new Image,c=b.find("a"),d.src=c.length>0?c.attr("href"):b.find("img").attr("src");if(a.length>0)c=new Image,b=a.find("a"),c.src=b.length>0?b.attr("href"):a.find("img").attr("src")},caption:function(a,b){var c=b.data("caption");c?a.text(c).show():a.text("").hide()},go:function(a,b){var c=a.find(".visible"),d=c[b]();d.length>0&&d.find("img").trigger("click",[c,d])},shift:function(a,
b,c){var d=b.parent();d.closest(".clearing-container");b.position();d.position();var f=g.prev_index,j=this.direction(d,a,b),h=parseInt(d.css("left"),10),a=b.outerWidth();b.index()!==f&&!/skip/.test(j)?/left/.test(j)?(e.lock(),d.animate({left:h+a},300,e.unlock)):/right/.test(j)&&(e.lock(),d.animate({left:h-a},300,e.unlock)):/skip/.test(j)&&(b=b.index()-g.up_count,e.lock(),b>0?d.animate({left:-(b*a)},300,e.unlock):d.animate({left:0},300,e.unlock));c()},lock:function(){g.locked=!0},unlock:function(){g.locked=
!1},locked:function(){return g.locked},direction:function(a,b,c){var a=a.find("li"),d=a.outerWidth()+a.outerWidth()/4,e=f(".clearing-container"),d=Math.floor(e.outerWidth()/d)-1,c=a.index(c);a.index(b);g.up_count=d;b=this.adjacent(g.prev_index,c)?c>d&&c>g.prev_index?"right":c>d-1&&c<=g.prev_index?"left":!1:"skip";g.prev_index=c;return b},adjacent:function(a,b){if(b-1===a)return!0;else if(b+1===a)return!0;else if(b===a)return!0;return!1},center:function(a){a.css({marginLeft:-(a.outerWidth()/2),marginTop:-(a.outerHeight()/
2)})},outerHTML:function(a){return a.outerHTML||(new XMLSerializer).serializeToString(a)},extend:function(a,b){f.each(a,function(a,d){b.hasOwnProperty(a)&&(i[a]=d)});f.extend(e,b)},_super:function(a,b){return i[a].apply(this,b)}};f.fn.foundationClearing=function(a){if(e[a])return e[a].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof a==="object"||!a)return e.init.apply(this,arguments);else f.error("Method "+a+" does not exist on jQuery.foundationClearing")};(function(a){a.fn.is_good=
function(b,c){function d(){i-=1;!i&&b()}function e(){this.one("load",d);if(a.browser.msie){var b=this.attr("src"),c=b.match(/\?/)?"&":"?";c+=f.cachePrefix+"="+(new Date).getTime();this.attr("src",b+c)}}var f=a.extend({},a.fn.is_good.defaults,c),g=this.find("img").add(this.filter("img")),i=g.length;return g.each(function(){var b=a(this);b.attr("src")?this.complete||this.readyState===4?d():e.call(b):d()})};a.fn.is_good.defaults={cachePrefix:"random"}})(jQuery)})(jQuery,this);
